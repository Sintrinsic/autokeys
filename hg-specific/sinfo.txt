toKVP(){ echo $1 | awk '/dedi/{print "box_hostname "$0}/([0-9]{1,3}\.){3}[0-9]{1,3}/{print "ip "$1}/DC-[0-9]{1,6}/{print "back_reference "substr($1, 4,10)}';}; findDedi(){ echo; boxInfo=$(hal server_list $(toKVP $1) select id,ip,box_id,image_name,tenant_back_ref,box_hostname,status); ( echo "$boxInfo" | awk '!/box_id/&&!/id/'; boxID=$(echo "$boxInfo" | awk '/box_id/{print $NF}'); hal box_list id $boxID select ip,ip_ipmi,ipmi_user,ipmi_pass,server_id | sed -E 's/ip([ _])/box_ip\1/' ;) | sed -E 's/.*box_ip/box_ip/;s/tenant_back_ref/billing_url/;s/box_hostname/hal_url/'| perl -lane 'if(!@F[1]){@F[1]=@F[0];@F[0]="-";};$end = "@F[1..100]"; $end =~ s/ +(?=\w)/_/g; print @F[0]." ".$end'| while read line; do echo $line | grep -iP "(windows|decom)" &>/dev/null && printf "\033[1;31m$line\033[0m\n\n" 2>/dev/null  || printf "$line\n" 2>/dev/null; done|  column -t ;}; findDedi