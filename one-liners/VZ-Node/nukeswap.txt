cooldown() { _node=$(cat /proc/loadavg); for _ct in $@; do echo "$(date +%s),$_ct,$(vzlist -H $_ct -o ip,hostname,laverage),(emergency swap reclamation. Load: : $_node)" >> /opt/hgvps/cooldown.log; vzctl stop $_ct & echo "vzctl set $_ct --disabled no --offline_management yes --save && vzctl start $_ct" | at now + 5min; done; }; cooldown $(grep -P "(VmSwap|envID)" /proc/*/status 2>/dev/null | sed 's/\/status.*://' | awk '{proc[$1]=proc[$1]" "$2" "$3}END{for(info in proc){print proc[info]}}' | awk '/[kmg]B/&&$1>100{ttl[$1]+=$2}END{for(ctid in ttl){print ctid,ttl[ctid], "kB"}}' | sort -nk2 | tail -n 10 | awk '{print $1}') 