uprocs(){ tscale=60; [[ $1 ]] && tscale=$1; printf "\033[1;34m======== All processes ========\n"; for i in $(seq 1 $tscale); do ps fauxww | grep $(pwd | cut -d"/" -f3)  | grep php | sed "s/^/$(date +%s) /"; sleep 1; done| awk '{if(!ps[$3" "$2]){ps[$3" "$2]=$1};if($4>=pc[$3" "$2]){pc[$3" "$2]=$4};pe[$3" "$2]=$1;pd[$3" "$2]=$0;t[$1]+=$4;}END{for(p in ps){print p, pc[p], pe[p]-ps[p],"||", pd[p]};ttl=0;cnt=0;for(s in t){cnt++; ttl+=t[s]};print "Avg_cpu: - "(ttl/cnt);}' | sort -nk3 -nk4 | perl -pe 's/\|\|.*?_//' | (printf "PID USR CPU SECS CMD\033[1;31m\n"; cat) | column -t | awk '$3>25&&$4>1&&$1!~"PID"{printf "\033[1;31m"; badlines[$1]=$0;}{print $0"\033[0m";}END{print "";print "\033[1;31m===== Just bad processes  ====="; for(p in badlines){print badlines[p]}}';printf "\033[0m"; }; uprocs