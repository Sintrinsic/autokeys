function dt(){ [[ $(stat /home1/apachelogs) ]] && al="/home1/apachelogs/" || al="/home/apachelogs/"; logfile=$(echo $al$(pwd | cut -d"/" -f3)/$(grep -B10 "$(pwd)$" /usr/local/apache/conf/httpd.conf | grep -Po '(?<=ServerName ).*' | uniq)"-"$(date "+%b-%Y")".gz"); domain=$(grep -B10 "$(pwd)$" /usr/local/apache/conf/httpd.conf | grep -Po '(?<=ServerName ).*' | uniq); echo "--------- Nginx errors ----------"; zgrep $domain /var/log/nginx/* | cut -d":" -f2 | sed 's/\(.*\)/\1:00/' | sort | uniq -c | sort -k2d -k3d | tail -n5; echo "--------- Too many connection errors ---------"; grep -i "too many connections" /var/lib/mysql/$(grep -oP "(?<=HOSTNAME=).*" /etc/sysconfig/network).err | sed 's/\(..\)\(..\)\(..\)/\1-\2-\3/' | awk '{"date --date=\""$1" "$2"\" \"+%D %H\":00" | getline d; print d}' | sort | uniq -c | sort -dk2; echo "--------- Gaps in successful hits ----------"; od=0; (zcat $logfile||cat $logfile) | awk -F"[  []" '/HTTP\/1.." (200|301|302)/{print $5}' | sed 's/:/  /;s&/&-&g' | while read line; do nd=$(date --date="$line"  "+%s"); echo $line" "$(( $nd - $od ));od=$nd; done | awk '{if($NF > 400){print $0}}'|tail -n10; echo "---------- uptime -----------"; uptime; echo "------------ iskilled -------------"; iskilled; echo "------ Recent admin activity --------"; history | grep "USER BEGIN" | grep -v grep| tail -n 10; }; dt