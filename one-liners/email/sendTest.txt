function sendTest(){ pwtemp unsetmail $1 &>/dev/null; lip=$(ip a | grep "inet " | grep -v "127.0.0.1" | awk '{print $2}' | cut -d"/" -f1 | tail -n1);temp=$(echo $(pwtemp setmail $1) | grep -Po "(?<=user ).*(?= note:)"); if [ $2 ]; then target=$2; else target="cubecitytest@gmail.com"; fi; account=$(echo $temp | awk -F" is " '{print $1}'); echo; echo "Sending from $account to $target now"; pass=$(echo $temp | awk -F" is " '{print $2}'); echo "This is a test from your host. Please ignore." | mailx -S "smtp-auth-user=$account" -S "smtp-auth-password=$pass" -S "from=$account" -S "smtp=$lip:25" -S "smtp-auth=login" -s "This is a test." $target; echo "Login info: $account $pass"; echo; sleep 3; tail -n 500 /var/log/exim_mainlog | exigrep $account ; }; sendTest