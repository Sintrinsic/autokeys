function myabusers(){ while true; do proclist=$(mysql -NBe "SELECT USER, TIME, ROWS_READ, ROWS_SENT, STATE FROM INFORMATION_SCHEMA.PROCESSLIST;");states=$(echo "$proclist" | awk  'BEGIN{ttls["p"]=0;ttls["t"]=0;ttls["k"]=0; ORS="|";} $6~/permissions/{ttls["p"]+=1} $7~/tmp/{ttls["t"]+=1} $5~/killed/{ttls["k"]+=1} END{printf "|";for(v in ttls){if(ttls[v]>0){printf "\033[1;31m"}; printf v":"ttls[v]; if(ttls[v]>0){printf "\033[1;34m"};printf "|";}}'); printf "\033[1;34m------- $(date) -- :Total:($(echo "$proclist" | wc -l)): -- $states ---------\033[0m\n"; base=$(echo "$proclist" | gawk -F"[\t]" '{split($1,un,"_");$1=un[1]; cnt[$1]++;ut[$1]+=$2;rr[$1]+=$3;rs[$1]+=$4} END{for(usr in cnt){print usr"",cnt[usr],ut[usr],rr[usr],rs[usr]}}'); paste -d"|" <(printf "QUERIES #\n $(echo "$base" | awk '{print $1,$2}' | sort -nk2 | tail -n5)\n") <(printf "TIME #\n $(echo "$base" | awk '{print $1,$3}' | sort -nk2 | tail -n5)\n") <(printf "READ #\n $(echo "$base" | awk '{print $1,$4}' | sort -nk2 | tail -n5)\n" ) <(printf "SENT #\n $(echo "$base" | awk '{print $1,$5}' | sort -nk2 | tail -n5)\n" ) | sed 's/|/ | /g' | column -t; sleep 1; done;}; myabusers